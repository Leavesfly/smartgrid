# 快速入门

<cite>
**本文档中引用的文件**  
- [README.md](file://README.md)
- [pom.xml](file://pom.xml)
- [RetailerServer.java](file://src/main/java/io/leavesfly/smartgrid/retailer/RetailerServer.java)
- [Users.java](file://src/main/java/io/leavesfly/smartgrid/user/Users.java)
- [RetailerInitArgs.java](file://src/main/java/io/leavesfly/smartgrid/retailer/RetailerInitArgs.java)
- [UsersArgs.java](file://src/main/java/io/leavesfly/smartgrid/user/UsersArgs.java)
- [LogToTxtFile.java](file://src/main/java/io/leavesfly/smartgrid/retailer/LogToTxtFile.java)
- [UserThread.java](file://src/main/java/io/leavesfly/smartgrid/user/UserThread.java)
</cite>

## 目录
1. [环境准备](#环境准备)
2. [项目编译](#项目编译)
3. [系统运行](#系统运行)
4. [启动顺序与终端配置](#启动顺序与终端配置)
5. [运行验证检查点](#运行验证检查点)
6. [常见问题排查](#常见问题排查)
7. [完整运行示例](#完整运行示例)

## 环境准备

在开始使用智能电网需求响应管理系统之前，需要确保您的开发环境满足以下要求：

- **Java版本**: Java 8 或更高版本
- **构建工具**: Maven 3.x
- **操作系统**: Windows、Linux 或 macOS

您可以通过以下命令验证环境配置是否正确：

```bash
java -version
mvn -version
```

如果命令能够正常输出版本信息，则说明环境配置正确。

**Section sources**
- [README.md](file://README.md#L25-L27)

## 项目编译

使用Maven工具编译项目，生成可执行的类文件。执行以下命令：

```bash
mvn clean package
```

该命令会执行以下操作：
1. 清理之前的编译输出（`clean`）
2. 编译所有Java源代码
3. 将编译后的类文件打包到 `target/classes` 目录中

编译成功后，您将在项目根目录下看到 `target` 文件夹，其中包含编译后的类文件。

**Section sources**
- [README.md](file://README.md#L72-L74)
- [pom.xml](file://pom.xml#L1-L26)

## 系统运行

系统由两个主要组件构成：零售商服务器和用户客户端。这两个组件需要分别启动并按特定顺序运行。

### 零售商服务器启动

零售商服务器是系统的核心，负责监听用户连接、计算最优电价并向用户广播。启动命令如下：

```bash
java -cp target/classes io.leavesfly.smartgrid.retailer.RetailerServer
```

该命令的参数说明：
- `-cp target/classes`: 指定类路径，包含编译后的所有类文件
- `io.leavesfly.smartgrid.retailer.RetailerServer`: 主类的完全限定名

### 用户客户端启动

用户客户端连接到零售商服务器，接收电价信息并计算最优用电策略。启动命令如下：

```bash
java -cp target/classes io.leavesfly.smartgrid.user.Users
```

该命令的参数说明：
- `-cp target/classes`: 指定类路径，与服务器相同
- `io.leavesfly.smartgrid.user.Users`: 用户模块的启动类

**Section sources**
- [README.md](file://README.md#L77-L87)
- [RetailerServer.java](file://src/main/java/io/leavesfly/smartgrid/retailer/RetailerServer.java#L1-L42)
- [Users.java](file://src/main/java/io/leavesfly/smartgrid/user/Users.java#L1-L13)

## 启动顺序与终端配置

正确的启动顺序对于系统正常运行至关重要。请遵循以下步骤：

1. **首先启动零售商服务器**
   - 打开第一个终端窗口
   - 导航到项目根目录
   - 执行零售商服务器启动命令
   - 服务器将开始监听端口并等待用户连接

2. **然后启动用户客户端**
   - 打开第二个终端窗口（必须是独立的终端）
   - 导航到项目根目录
   - 执行用户客户端启动命令
   - 用户线程将尝试连接到零售商服务器

### 终端配置要点

- **必须使用两个独立的终端窗口**：因为零售商服务器启动后会进入持续运行状态，单个终端无法同时执行两个命令
- **保持终端窗口打开**：系统运行期间，两个终端窗口都必须保持打开状态
- **正确的项目路径**：确保在项目根目录下执行命令，否则类路径将无法正确解析

零售商服务器的默认监听端口为1234，配置在 `RetailerInitArgs.java` 文件中。用户客户端的连接配置在 `UsersArgs.java` 文件中，确保IP地址和端口与服务器配置匹配。

**Section sources**
- [RetailerInitArgs.java](file://src/main/java/io/leavesfly/smartgrid/retailer/RetailerInitArgs.java#L1-L15)
- [UsersArgs.java](file://src/main/java/io/leavesfly/smartgrid/user/UsersArgs.java#L1-L45)
- [RetailerServer.java](file://src/main/java/io/leavesfly/smartgrid/retailer/RetailerServer.java#L1-L42)
- [UserThread.java](file://src/main/java/io/leavesfly/smartgrid/user/UserThread.java#L1-L86)

## 运行验证检查点

系统成功运行时，您应该在终端和日志文件中看到以下特征性输出：

### 零售商服务器检查点

在零售商服务器终端中，您应该看到以下输出：
```
服务端口1234启动...
启动一个线程...
开始计算...
```

这些输出表明：
- 服务器已在端口1234成功启动
- 服务器已准备好接受用户连接
- SAPC算法已开始执行计算

### 用户客户端检查点

在用户客户端终端中，您应该看到类似以下输出：
```
user_0启动...
user_1启动...
User_0当前的socket端口XXXXX获取连接成功...
User_0成功获取到广播的电价[价格向量内容]
User_0在该价格下规划得到的用电量[用电向量内容]
```

这些输出表明：
- 用户线程已成功创建
- 用户已成功连接到零售商服务器
- 用户已成功接收电价信息并计算出用电策略

### 日志文件验证

系统会将详细日志记录到文件中：
- 零售商日志：`E:\RetailerLog.txt`
- 用户日志：`E:\UsersLog.txt`

检查这些文件是否存在且有内容写入，可以进一步确认系统正常运行。

**Section sources**
- [RetailerServer.java](file://src/main/java/io/leavesfly/smartgrid/retailer/RetailerServer.java#L1-L42)
- [UserThread.java](file://src/main/java/io/leavesfly/smartgrid/user/UserThread.java#L1-L86)
- [LogToTxtFile.java](file://src/main/java/io/leavesfly/smartgrid/retailer/LogToTxtFile.java#L1-L32)

## 常见问题排查

### 端口占用问题

**症状**：启动零售商服务器时出现 `java.net.BindException: Address already in use` 错误

**解决方案**：
1. 检查端口1234是否已被其他进程占用：
   ```bash
   # Linux/macOS
   lsof -i :1234
   # Windows
   netstat -ano | findstr :1234
   ```
2. 如果端口被占用，可以选择：
   - 终止占用端口的进程
   - 修改 `RetailerInitArgs.java` 中的 `ListenPort` 值为其他未被占用的端口
   - 同时修改 `UsersArgs.java` 中的 `port` 值保持一致

### 类路径错误

**症状**：出现 `ClassNotFoundException` 或 `NoClassDefFoundError`

**解决方案**：
1. 确保已成功执行 `mvn clean package` 命令
2. 确认 `target/classes` 目录存在且包含编译后的类文件
3. 检查启动命令中的类路径是否正确：`-cp target/classes`
4. 确保主类名称拼写正确，包括完整的包名

### 连接失败问题

**症状**：用户客户端显示连接超时或拒绝连接

**解决方案**：
1. 确认零售商服务器已先于用户客户端启动
2. 检查 `UsersArgs.java` 中的IP地址是否正确（默认为 `127.0.0.1`）
3. 确认端口配置一致（默认为1234）
4. 检查防火墙设置是否阻止了该端口的通信

### 日志文件创建失败

**症状**：日志文件未在 `E:\` 盘创建

**解决方案**：
1. 确保 `E:\` 盘存在且有写入权限
2. 或者修改 `RetailerInitArgs.java` 和 `UsersArgs.java` 中的日志文件路径为本地存在的路径

**Section sources**
- [RetailerInitArgs.java](file://src/main/java/io/leavesfly/smartgrid/retailer/RetailerInitArgs.java#L1-L15)
- [UsersArgs.java](file://src/main/java/io/leavesfly/smartgrid/user/UsersArgs.java#L1-L45)
- [LogToTxtFile.java](file://src/main/java/io/leavesfly/smartgrid/retailer/LogToTxtFile.java#L1-L32)

## 完整运行示例

以下是从零开始成功运行系统的完整步骤示例：

### 步骤1：环境验证
```bash
# 验证Java版本
java -version
# 验证Maven版本
mvn -version
```

### 步骤2：项目编译
```bash
# 在项目根目录执行
mvn clean package
```

### 步骤3：启动零售商服务器
```bash
# 在第一个终端窗口中执行
java -cp target/classes io.leavesfly.smartgrid.retailer.RetailerServer
```

### 步骤4：启动用户客户端
```bash
# 在第二个终端窗口中执行
java -cp target/classes io.leavesfly.smartgrid.user.Users
```

### 预期输出

**零售商服务器终端**：
```
服务端口1234启动...
启动一个线程...
开始计算...
```

**用户客户端终端**：
```
user_0启动...
user_1启动...
User_0当前的socket端口54321获取连接成功...
User_0成功获取到广播的电价[价格向量内容]
User_0在该价格下规划得到的用电量[用电向量内容]
```

当您看到上述输出时，说明系统已成功运行，零售商和用户之间的通信已建立，SAPC算法正在执行优化计算。

**Section sources**
- [README.md](file://README.md#L72-L87)
- [RetailerServer.java](file://src/main/java/io/leavesfly/smartgrid/retailer/RetailerServer.java#L1-L42)
- [Users.java](file://src/main/java/io/leavesfly/smartgrid/user/Users.java#L1-L13)